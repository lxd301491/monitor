"use strict";function _interopDefault(t){return t&&"object"==typeof t&&"default"in t?t.default:t}Object.defineProperty(exports,"__esModule",{value:!0});var axios=_interopDefault(require("axios")),pako=_interopDefault(require("pako")),localForage=_interopDefault(require("localforage")),extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function __extends(t,e){function n(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var __assign=function(){return(__assign=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function __decorate(t,e,n,r){var o,i=arguments.length,a=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(i<3?o(a):i>3?o(e,n,a):o(e,n))||a);return i>3&&a&&Object.defineProperty(e,n,a),a}function __awaiter(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{c(r.next(t))}catch(t){i(t)}}function s(t){try{c(r.throw(t))}catch(t){i(t)}}function c(t){t.done?o(t.value):new n((function(e){e(t.value)})).then(a,s)}c((r=r.apply(t,e||[])).next())}))}function __generator(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}function __values(t){var e="function"==typeof Symbol&&t[Symbol.iterator],n=0;return e?e.call(t):{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}var globalConfig,lifeCycle={consume:{before:function(){},after:function(){}},track:{before:function(){},after:function(){}}};function before(t,e,n){return{value:function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return lifeCycle[e]&&lifeCycle[e].before.apply(this,t),n.value.apply(this,t)}}}function after(t,e,n){return{value:function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return __awaiter(this,void 0,void 0,(function(){var r;return __generator(this,(function(o){switch(o.label){case 0:return[4,n.value.apply(this,t)];case 1:return r=o.sent(),lifeCycle[e]&&lifeCycle[e].after.apply(this,[r]),[2,r]}}))}))}}}function replace(t,e,n,r){window._replace_center_||(window._replace_center_={});var o=r?window._replace_center_[r]?window._replace_center_[r]:window._replace_center_[r]={}:window._replace_center_;o[e]||(o[e]=t[e],t[e]=n)}function reduction(t,e,n){window._replace_center_||(window._replace_center_={});var r=n?window._replace_center_[n]?window._replace_center_[n]:window._replace_center_[n]={}:window._replace_center_;window._replace_center_[e]&&(t[e]=r[e],delete r[e])}function getBasicInfo(){return __assign({},getUniqueInfo(),getConnection(),{page:window.location.href,uId:getCookie("uId")||"",rId:getCookie("rId")||"",msg:"",ms:"unkown",ml:"info",dId:getCookie("deviceId")||"",dt:getCookie("deviceType")||"",sys:getCookie("sys")||"",sv:getCookie("sysVersion")||"",sw:getScreen().w,sh:getScreen().h,v:"1.0.27"})}function getScreen(){return{w:document.documentElement.clientWidth||document.body.clientWidth,h:document.documentElement.clientHeight||document.body.clientHeight}}function randomString(t){t=t||10;for(var e="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz123456789",n=e.length,r="",o=0;o<t;o++)r+=e.charAt(Math.floor(Math.random()*n));return r+"_"+(new Date).getTime()}function getCookie(t){var e,n=new RegExp("(^| )"+t+"=([^;]*)(;|$)");return(e=document.cookie.match(n))?e[2]:null}function getUniqueInfo(){var t=getCookie("uni");if(!t){t=randomString(10);var e=new Date;e.setDate(e.getDate()+globalConfig.expiredays),document.cookie="uni="+t+";domain="+document.domain+";path=/;expires="+e.toGMTString()}return{uni:t}}function perforPage(){if(!window.performance)return{};var t=performance.timing;return{dnst:t.domainLookupEnd-t.domainLookupStart||0,tcpt:t.connectEnd-t.connectStart||0,wit:t.responseStart-t.navigationStart||0,domt:t.domContentLoadedEventEnd-t.navigationStart||0,lodt:t.loadEventEnd-t.navigationStart||0,radt:t.fetchStart-t.navigationStart||0,rdit:t.redirectEnd-t.redirectStart||0,uodt:t.unloadEventEnd-t.unloadEventStart||0,reqt:t.responseEnd-t.requestStart||0,andt:t.domComplete-t.domInteractive||0}}function getConnection(){var t=navigator.connection;if(!t)return{ct:navigator.onLine?"online":"offline"};var e=t.rtt,n=t.downlink;return{ct:t.effectiveType,cs:n+"Mb/s",cr:e+"ms",csa:t.saveData}}function on(t,e,n){window.addEventListener&&window.addEventListener(t,(function r(o){n&&window.removeEventListener(t,r,!0),e.call(this,o)}),!0),window.attachEvent&&window.attachEvent("on"+t,(function r(o){n&&window.detachEvent("on"+t,r),e.call(this,o)}))}function off(t,e){window.removeEventListener&&window.removeEventListener(t,e),window.detachEvent&&window.detachEvent(t,e)}function dispatchCustomEvent(t,e){var n;CustomEvent?n=new CustomEvent(t,{detail:e}):((n=window.document.createEvent("HTMLEvents")).initEvent(t,!1,!0),n.detail=e),window.dispatchEvent(n)}function parseHash(t){return(t?parseUrl(t.replace(/^#\/?/,"")):"")||"[index]"}function parseUrl(t){return t.replace(/^(https?:)?\/\//,"").replace(/\?.*$/,"")}function pv(t,e){t.track({page:e||void 0,dot:document.title,dol:location.href,dr:document.referrer,dpr:window.devicePixelRatio,de:document.charset,msg:"",ms:"pv",ml:"info"})}function Logger(t,e,n){/function\s+(.*)\s*\(/.exec(t.constructor.toString());RegExp.$1;/function.*?\((.*)\)/.exec(n.value.toString());RegExp.$1.split(",");return{value:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=n.value.apply(this,t);return globalConfig.debug&&r instanceof Promise&&r.then((function(t){})).catch((function(t){})),r}}}!function(t){t.timeout=2e4,t.expiredays=864e5,t.infoLenMax=1e3,t.debug=!1}(globalConfig||(globalConfig={}));var MonitorProvider=function(){function t(t){this.store=t}return t.prototype.mountStore=function(t){this.store=t},t.prototype.track=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){return t=__assign({},getBasicInfo(),t),this.store&&this.store.push(t),[2,this]}))}))},__decorate([before,after,Logger],t.prototype,"track",null),t}(),Counter=function(){function t(t){this.nums=[],this.reserved=t}return t.prototype.get=function(){var t=this,e=Date.now();return this.nums=this.nums.filter((function(n){return n>e-1e3*t.reserved})),this.nums.length},t.prototype.increase=function(){var t=this,e=Date.now();this.nums=this.nums.filter((function(n){return n>e-1e3*t.reserved})),this.nums.push(Date.now())},t.prototype.decrease=function(){this.nums.shift()},t.prototype.reset=function(){this.nums=[]},t}(),AbstractState=function(){function t(t){void 0===t&&(t=Date.now()),this.startTime=t}return t.prototype.canPass=function(t){return!0},t.prototype.checkout=function(t){},t}(),HalfOpenState=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.canPass=function(t){var e=parseInt(t.thresholdForHalfOpen[0]);return t.getCount()<=e},e.prototype.checkout=function(t){t.getCount()>parseInt(t.thresholdForHalfOpen[0])?t.setState(new OpenState):t.setState(new CloseState)},e}(AbstractState),OpenState=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.canPass=function(){return!1},e.prototype.checkout=function(t){var e=1e3*t.idleTimeForOpen;Date.now()>=this.startTime+e&&t.setState(new HalfOpenState)},e}(AbstractState),CloseState=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.canPass=function(t){return!0},e.prototype.checkout=function(t){t.getCount()>=parseInt(t.thresholdForOpen[0])&&t.setState(new OpenState)},e}(AbstractState),CircuitBreaker=function(){function t(t,e,n){void 0===t&&(t="1/60"),void 0===e&&(e=300),void 0===n&&(n="1/60"),this.idleTimeForOpen=e,this.thresholdForOpen=t.split("/"),this.thresholdForHalfOpen=n.split("/"),this.counter=new Counter(Math.max(parseInt(this.thresholdForOpen[1]),parseInt(this.thresholdForHalfOpen[1]))),this.state=new CloseState}return t.prototype.getStateName=function(){return/^function\s(.*)\(/.exec(this.state.constructor+""),RegExp.$1},t.prototype.getState=function(){return this.state},t.prototype.setState=function(t){this.state=t},t.prototype.reset=function(){this.counter.reset()},t.prototype.canPass=function(){return this.getState().checkout(this),this.getState().canPass(this)},t.prototype.count=function(){this.counter.increase()},t.prototype.getCount=function(){return this.counter.get()},t.prototype.getDuration=function(){return(Date.now()-this.state.startTime)/1e3},t}(),MonitorConsumer=function(){function t(t,e){if(void 0===e&&(e="image"),this.abnormalBreaker=new CircuitBreaker("5/60",300,"0/60"),"beacon"===e&&!navigator.sendBeacon)throw ReferenceError("EmitType is beacon,but navigator.setBeacon is undefined");this.api=t,this.emitType=e}return t.prototype.setAbnormalBreaker=function(t){this.abnormalBreaker=t},t.prototype.consume=function(t,e){return void 0===e&&(e=!1),__awaiter(this,void 0,void 0,(function(){return __generator(this,(function(n){switch(n.label){case 0:if(!this.abnormalBreaker.canPass())return[2];e&&t.length>globalConfig.infoLenMax&&(t=encodeURIComponent(t),t=pako.gzip(t,{to:"string"})),n.label=1;case 1:switch(n.trys.push([1,9,,10]),this.emitType){case"image":return[3,2];case"fetch":return[3,4];case"beacon":return[3,6]}return[3,8];case 2:return[4,this.imageConsume(t)];case 3:return n.sent(),[3,8];case 4:return[4,this.fetchConsume(t)];case 5:return n.sent(),[3,8];case 6:return[4,this.beaconConsume(t)];case 7:return n.sent(),[3,8];case 8:return[3,10];case 9:return n.sent(),this.abnormalBreaker.count(),[3,10];case 10:return[2]}}))}))},t.prototype.imageConsume=function(t){var e=this,n=new Image;return new Promise((function(r,o){n.onerror=function(t){o(t)},n.onload=function(t){r(t)},n.onabort=function(t){o(t)},n.src=e.api+"?data="+t}))},t.prototype.fetchConsume=function(t){return axios.post(this.api,{data:t})},t.prototype.beaconConsume=function(t){var e=this;return!(!window||!window.navigator||"function"!=typeof window.navigator.sendBeacon)&&new Promise((function(n,r){window.navigator.sendBeacon(e.api,JSON.stringify({data:t}))?n():r()}))},__decorate([before,after,Logger],t.prototype,"consume",null),t}(),Store=function(){function t(t){this.appName=t,this.store=localForage.createInstance({name:t,storeName:t})}return t.prototype.destory=function(){this.store.dropInstance({name:this.appName,storeName:this.appName})},t.prototype.shiftMore=function(t){return void 0===t&&(t=15),__awaiter(this,void 0,void 0,(function(){var e,n,r,o;return __generator(this,(function(i){switch(i.label){case 0:return e=[],[4,this.length()];case 1:n=i.sent(),n=t>n?n:t,i.label=2;case 2:return--n>-1?(o=(r=e).push,[4,this._shift()]):[3,4];case 3:return o.apply(r,[i.sent()]),[3,2];case 4:return 0===e.length?[2,""]:[2,e=JSON.stringify(e)]}}))}))},t.prototype._shift=function(){return __awaiter(this,void 0,void 0,(function(){var t,e;return __generator(this,(function(n){switch(n.label){case 0:return t="",[4,this.keys()];case 1:return e=n.sent().shift()||"",[4,this.store.getItem(e)];case 2:return t=n.sent(),[4,this.store.removeItem(e)];case 3:return n.sent(),[2,t]}}))}))},t.prototype.push=function(t){return __awaiter(this,void 0,void 0,(function(){var e;return __generator(this,(function(n){switch(n.label){case 0:return e=this.appName+"_"+(new Date).getTime(),[4,this.store.setItem(e,t)];case 1:return n.sent(),[2]}}))}))},t.prototype.length=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:return[4,this.store.length()];case 1:return[2,t.sent()]}}))}))},t.prototype.clear=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:return[4,this.store.clear()];case 1:return[2,t.sent()]}}))}))},t.prototype.keys=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:return[4,this.store.keys()];case 1:return[2,t.sent()]}}))}))},t.prototype.iterate=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,this.store.iterate(t)];case 1:return[2,e.sent()]}}))}))},t.prototype.customDriver=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){return this.store.defineDriver(t),[2]}))}))},t}(),AbstractHook=function(t){this.provider=t},NativeHook=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.handlers=new Map,e.timers=new Map,e.delta=3,e.deltaMax=15,e}return __extends(e,t),e.prototype.clearCallFlag=function(t){this.handlers.delete(t),this.timers.delete(t)},e.prototype.handleCall=function(t,e,n,r){if(r){var o=randomString(15);this.handlers.set(o,Date.now()),this.timers.set(o,setTimeout((function(){a.provider.track({msg:t+"."+e+" args "+JSON.stringify(n)+", callback take over 15s",ms:"native",ml:"warning"}),a.clearCallFlag(o)}),1e3*this.deltaMax));var i=r,a=this;r=function(){var r=Date.now()-(a.handlers.get(o)||Date.now());r>1e3*a.delta&&a.provider.track({msg:t+"."+e+" args "+JSON.stringify(n)+", callback take "+r+"ms",ms:"native",ml:"info"});var s=a.timers.get(o);s&&clearTimeout(s),a.clearCallFlag(o),i.apply(a,arguments)}}window._replace_center_.native.call.apply(this.nativeBridge,[t,e,n,r])},e.prototype.watch=function(t){if(this.nativeBridge=t||this.nativeBridge,!this.nativeBridge)throw Error("NativeHook can not start watch, has not initlized");replace(this.nativeBridge,"call",this.handleCall.bind(this),"native")},e.prototype.unwatch=function(){reduction(this.nativeBridge,"call","native")},e}(AbstractHook),ErrorHook=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.listener=function(t){if(t.stopPropagation(),t.preventDefault(),t.target instanceof HTMLImageElement||t.target instanceof HTMLScriptElement||t.target instanceof HTMLLinkElement){var e=t.target instanceof HTMLImageElement||t.target instanceof HTMLScriptElement?t.target.src:t.target instanceof HTMLLinkElement?t.target.href:"";this.provider.track({msg:t.target.outerHTML,file:e,stack:t.target.localName.toUpperCase(),line:0,col:0,ms:"error",ml:"error"})}else{var n="";if(t.error&&t.error.stack)n=t.error.stack.toString();else if(arguments){for(var r=[],o=arguments.callee.caller,i=3;o&&--i>0&&(r.push(o.toString()),o!==o.caller);)o=o.caller;n=r.join(",")}this.provider.track({file:t.filename,line:t.lineno,col:t.colno,stack:n,msg:t.message,ms:"error",ml:"error"})}},e.prototype.watch=function(t){on("error",this.listener.bind(this))},e.prototype.unwatch=function(){off("error",this.listener.bind(this))},e}(AbstractHook),actions=["click","input","blur"],ActionHook=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.getCurrentElement=function(t){var e=t.outerHTML.match("<.+?>");return e&&e[0]||""},e.prototype.listener=function(t){t instanceof MouseEvent?this.provider.track({msg:t.target instanceof HTMLElement?this.getCurrentElement(t.target):"",ms:"action",ml:"info",at:t.type,el:t.target instanceof HTMLElement?this.getCurrentElement(t.target):void 0,x:t.x,y:t.y}):t instanceof FocusEvent?this.provider.track({msg:t.target instanceof HTMLElement?this.getCurrentElement(t.target):"",ms:"action",ml:"info",at:t.type,el:t.target instanceof HTMLElement?this.getCurrentElement(t.target):void 0}):t instanceof KeyboardEvent?this.provider.track({msg:t.type+" "+t.key,ms:"action",ml:"info",at:t.type,key:t.key}):t instanceof InputEvent&&this.provider.track({msg:t.inputType+" "+t.data,ms:"action",ml:"info",at:t.type,key:t.data||""})},e.prototype.watch=function(t){var e,n;try{for(var r=__values(actions),o=r.next();!o.done;o=r.next()){on(o.value,this.listener.bind(this))}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}},e.prototype.unwatch=function(){var t,e;try{for(var n=__values(actions),r=n.next();!r.done;r=n.next()){off(r.value,this.listener.bind(this))}}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}},e}(AbstractHook),UncaughtHook=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.listener=function(t){t.stopPropagation(),t.preventDefault(),this.provider.track({msg:t.reason,ms:"uncaught",ml:"error"})},e.prototype.watch=function(t){on("unhandledrejection",this.listener.bind(this))},e.prototype.unwatch=function(){off("unhandledrejection",this.listener.bind(this))},e}(AbstractHook),SPARouterHook=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.hackState=function(t){replace(history,t,(function(e,n,r){replace(window,"onpopstate",(function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return window._replace_center_.onpopstate.apply(this,e)}));var o=location.href,i=window._replace_center_[t].apply(history,[e,n,r]);if(!r||r===o)return i;try{var a=o.split("#"),s=r.split("#"),c=parseUrl(a[0]),u=parseUrl(s[0]),h=a[1]&&a[1].replace(/^\/?(.*)/,"$1"),l=s[1]&&s[1].replace(/^\/?(.*)/,"$1");c!==u?dispatchCustomEvent("historystatechanged",u):h!==l&&dispatchCustomEvent("historystatechanged",l)}catch(t){}return i}))},e.prototype.dehackState=function(t){reduction(history,t),reduction(window,"onpopstate")},e.prototype.handleHashchange=function(t){var e=parseHash(location.hash.toLowerCase());pv(this.provider,e)},e.prototype.handleHistorystatechange=function(t){var e=parseHash(t.detail.toLowerCase());pv(this.provider,e)},e.prototype.watch=function(t){this.hackState("pushState"),this.hackState("replaceState"),on("hashchange",this.handleHashchange.bind(this)),on("historystatechanged",this.handleHistorystatechange.bind(this))},e.prototype.unwatch=function(){this.dehackState("pushState"),this.dehackState("replaceState"),off("hashchange",this.handleHashchange.bind(this)),off("historystatechanged",this.handleHistorystatechange.bind(this))},e}(AbstractHook),PerformanceHook=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.listener=function(t){var e=this;setTimeout((function(){e.provider.track(__assign({},perforPage(),{msg:"",ms:"performance",ml:"info"}))}),20)},e.prototype.watch=function(t){on("load",this.listener.bind(this))},e.prototype.unwatch=function(){off("load",this.listener.bind(this))},e}(AbstractHook),VueHook=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.watch=function(t){var e=this;if(this.vue=t||this.vue,!this.vue)throw Error("VueHook can not start watch, has not initlized");this.vue.config.errorHandler=function(t,n,r){var o="";if(n){var i=n;for(o=n.$options.name;i=i.$parent;)o=n.$options.name+"=>"+o}e.provider&&e.provider.track({msg:t.name+" "+t.message,file:o+" "+r,stack:t.stack,ms:"vue",ml:"error"})}},e.prototype.unwatch=function(){delete this.vue.config.errorHandler},e}(AbstractHook),HooksStore=function(){function t(t){this.hooks=new Map,this.provider=t}return t.prototype.getHooks=function(){return this.hooks},t.prototype.watch=function(t,e){var n=this.hooks.get(t);if(n)n.watch(e);else{switch(t){case"native":n=new NativeHook(this.provider);break;case"error":n=new ErrorHook(this.provider);break;case"action":n=new ActionHook(this.provider);break;case"uncaught":n=new UncaughtHook(this.provider);break;case"spa":n=new SPARouterHook(this.provider);break;case"performance":n=new PerformanceHook(this.provider);break;case"vue":n=new VueHook(this.provider);break;default:n=void 0}n&&this.hooks.set(t,n)}},t.prototype.unwatch=function(t){var e=this.hooks.get(t);e&&(e.unwatch(),this.hooks.delete(t))},t}(),MonitorCenter=function(){function t(t,e){this.consumers=new Map,globalConfig.debug=e||!1,this.store=new Store(t),this.provider=new MonitorProvider(this.store),this.hooks=new HooksStore(this.provider),pv(this.provider)}return t.prototype.start=function(t){var e=this;this.timer&&clearInterval(this.timer),this.timer=window.setInterval((function(){return __awaiter(e,void 0,void 0,(function(){var e;return __generator(this,(function(n){switch(n.label){case 0:return[4,this.store.shiftMore(t.size)];case 1:return(e=n.sent())&&this.consumers.forEach((function(n,r){n.consume(e,t.zip)})),[2]}}))}))}),t.period||15e3)},t.prototype.stop=function(){clearInterval(this.timer),this.timer=void 0},t.prototype.subscribeCustom=function(t){if(!this.store)throw new ReferenceError("The init method has not be invoked, please invoke it before this");var e=randomString(10);return this.consumers.set(e,t),e},t.prototype.subscribe=function(t,e){if(!this.store)throw new ReferenceError("The init method has not be invoked, please invoke it before this");var n=randomString(10);return this.consumers.set(n,new MonitorConsumer(t,e)),n},t.prototype.unsubscribe=function(t){this.consumers.delete(t)},t.prototype.getStore=function(){return this.store},t.prototype.track=function(t){this.provider.track(t)},t.prototype.watch=function(t,e){this.hooks.watch(t,e)},t.prototype.unwatch=function(t){this.hooks.unwatch(t)},t}();exports.CircuitBreaker=CircuitBreaker,exports.MonitorCenter=MonitorCenter,exports.lifeCycle=lifeCycle;
