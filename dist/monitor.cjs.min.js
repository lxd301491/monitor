"use strict";function _interopDefault(t){return t&&"object"==typeof t&&"default"in t?t.default:t}Object.defineProperty(exports,"__esModule",{value:!0});var axios=_interopDefault(require("axios")),pako=_interopDefault(require("pako")),localForage=_interopDefault(require("localforage")),extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function __extends(t,e){function r(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var __assign=function(){return(__assign=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function __decorate(t,e,r,n){var o,i=arguments.length,a=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(i<3?o(a):i>3?o(e,r,a):o(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a}function __awaiter(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{c(n.next(t))}catch(t){i(t)}}function s(t){try{c(n.throw(t))}catch(t){i(t)}}function c(t){t.done?o(t.value):new r((function(e){e(t.value)})).then(a,s)}c((n=n.apply(t,e||[])).next())}))}function __generator(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}function __values(t){var e="function"==typeof Symbol&&t[Symbol.iterator],r=0;return e?e.call(t):{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}}}var lifeCycle={consume:{before:function(){},after:function(){}},track:{before:function(){},after:function(){}}};function before(t,e,r){return{value:function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return lifeCycle[e]&&lifeCycle[e].before.apply(this,t),r.value.apply(this,t)}}}function after(t,e,r){return{value:function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return __awaiter(this,void 0,void 0,(function(){var n;return __generator(this,(function(o){switch(o.label){case 0:return[4,r.value.apply(this,t)];case 1:return n=o.sent(),lifeCycle[e]&&lifeCycle[e].after.apply(this,[n]),[2,n]}}))}))}}}function replace(t,e,r,n){var o=window||global||void 0;if(!o)throw new ReferenceError("the top object is not exist");o._replace_center_||(o._replace_center_={});var i=n?o._replace_center_[n]?o._replace_center_[n]:o._replace_center_[n]={}:o._replace_center_;i[e]||(i[e]=t[e],t[e]=r)}function reduction(t,e,r){var n=window||global||void 0;if(!n)throw new ReferenceError("the top object is not exist");n._replace_center_||(n._replace_center_={});var o=r?n._replace_center_[r]?n._replace_center_[r]:n._replace_center_[r]={}:n._replace_center_;n._replace_center_[e]&&(t[e]=o[e],delete o[e])}var expiredays=864e5,infoLenMax=1e3;function getBasicInfo(){return __assign(__assign(__assign({},getUniqueInfo()),getConnection()),{page:window.location.href,uId:getCookie("uId")||"",rId:getCookie("rId")||"",msg:"",ms:"unkown",ml:"info",dId:getCookie("deviceId")||"",dt:getCookie("deviceType")||"",sys:getCookie("sys")||"",sv:getCookie("sysVersion")||"",sw:getScreen().w,sh:getScreen().h,v:"1.1.9"})}function getScreen(){return{w:document.documentElement.clientWidth||document.body.clientWidth,h:document.documentElement.clientHeight||document.body.clientHeight}}function randomString(t){t=t||10;for(var e="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz123456789",r=e.length,n="",o=0;o<t;o++)n+=e.charAt(Math.floor(Math.random()*r));return n+"_"+(new Date).getTime()}function getCookie(t){var e,r=new RegExp("(^| )"+t+"=([^;]*)(;|$)");return(e=document.cookie.match(r))?e[2]:null}function getUniqueInfo(){var t=getCookie("uni");if(!t){t=randomString(10);var e=new Date;e.setDate(e.getDate()+expiredays),document.cookie="uni="+t+";domain="+document.domain+";path=/;expires="+e.toGMTString()}return{uni:t}}function perforPage(){if(!window.performance)return{};var t=performance.timing;return{dnst:t.domainLookupEnd-t.domainLookupStart||0,tcpt:t.connectEnd-t.connectStart||0,wit:t.responseStart-t.navigationStart||0,domt:t.domContentLoadedEventEnd-t.navigationStart||0,lodt:t.loadEventEnd-t.navigationStart||0,radt:t.fetchStart-t.navigationStart||0,rdit:t.redirectEnd-t.redirectStart||0,uodt:t.unloadEventEnd-t.unloadEventStart||0,reqt:t.responseEnd-t.requestStart||0,andt:t.domComplete-t.domInteractive||0}}function getConnection(){var t=navigator.connection;if(!t)return{ct:navigator.onLine?"online":"offline"};var e=t.rtt,r=t.downlink;return{ct:t.effectiveType,cs:r+"Mb/s",cr:e+"ms",csa:t.saveData}}function on(t,e,r){window.addEventListener&&window.addEventListener(t,(function n(o){r&&window.removeEventListener(t,n,!0),e.call(this,o)}),!0),window.attachEvent&&window.attachEvent("on"+t,(function n(o){r&&window.detachEvent("on"+t,n),e.call(this,o)}))}function off(t,e){window.removeEventListener&&window.removeEventListener(t,e),window.detachEvent&&window.detachEvent(t,e)}function dispatchCustomEvent(t,e){var r;CustomEvent?r=new CustomEvent(t,{detail:e}):((r=window.document.createEvent("HTMLEvents")).initEvent(t,!1,!0),r.detail=e),window.dispatchEvent(r)}function parseHash(t){return(t?parseUrl(t.replace(/^#\/?/,"")):"")||"[index]"}function parseUrl(t){return t.replace(/^(https?:)?\/\//,"").replace(/\?.*$/,"")}function pv(t,e){t.track(__assign(__assign({},getBasicInfo()),{dot:document.title,dol:location.href,dr:document.referrer,dpr:window.devicePixelRatio,de:document.charset,page:e||window.location.href,ms:"pv",ml:"info"}))}var MonitorProvider=function(){function t(t){this.store=t}return t.prototype.mountStore=function(t){this.store=t},t.prototype.track=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){return t=__assign(__assign({},t),getConnection()),this.store&&this.store.push(t),[2,this]}))}))},__decorate([before,after],t.prototype,"track",null),t}(),Counter=function(){function t(t){this.nums=[],this.reserved=t}return t.prototype.get=function(){var t=this,e=Date.now();return this.nums=this.nums.filter((function(r){return r>e-1e3*t.reserved})),this.nums.length},t.prototype.increase=function(){var t=this,e=Date.now();this.nums=this.nums.filter((function(r){return r>e-1e3*t.reserved})),this.nums.push(Date.now())},t.prototype.decrease=function(){this.nums.shift()},t.prototype.reset=function(){this.nums=[]},t}(),AbstractState=function(){function t(t){void 0===t&&(t=Date.now()),this.startTime=t}return t.prototype.canPass=function(t){return!0},t.prototype.checkout=function(t){},t}(),HalfOpenState=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.canPass=function(t){var e=parseInt(t.thresholdForHalfOpen[0]);return t.getCount()<=e},e.prototype.checkout=function(t){t.getCount()>parseInt(t.thresholdForHalfOpen[0])?t.setState(new OpenState):t.setState(new CloseState)},e}(AbstractState),OpenState=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.canPass=function(){return!1},e.prototype.checkout=function(t){var e=1e3*t.idleTimeForOpen;Date.now()>=this.startTime+e&&t.setState(new HalfOpenState)},e}(AbstractState),CloseState=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.canPass=function(t){return!0},e.prototype.checkout=function(t){t.getCount()>=parseInt(t.thresholdForOpen[0])&&t.setState(new OpenState)},e}(AbstractState),CircuitBreaker=function(){function t(t,e,r){void 0===t&&(t="1/60"),void 0===e&&(e=300),void 0===r&&(r="1/60"),this.idleTimeForOpen=e,this.thresholdForOpen=t.split("/"),this.thresholdForHalfOpen=r.split("/"),this.counter=new Counter(Math.max(parseInt(this.thresholdForOpen[1]),parseInt(this.thresholdForHalfOpen[1]))),this.state=new CloseState}return t.prototype.getStateName=function(){return/^function\s(.*)\(/.exec(this.state.constructor+""),RegExp.$1},t.prototype.getState=function(){return this.state},t.prototype.setState=function(t){this.state=t},t.prototype.reset=function(){this.counter.reset()},t.prototype.canPass=function(){return this.getState().checkout(this),this.getState().canPass(this)},t.prototype.count=function(){this.counter.increase()},t.prototype.getCount=function(){return this.counter.get()},t.prototype.getDuration=function(){return(Date.now()-this.state.startTime)/1e3},t}(),has=Object.prototype.hasOwnProperty,isArray=Array.isArray,hexTable=function(){for(var t=[],e=0;e<256;++e)t.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return t}(),compactQueue=function(t){for(;t.length>1;){var e=t.pop(),r=e.obj[e.prop];if(isArray(r)){for(var n=[],o=0;o<r.length;++o)void 0!==r[o]&&n.push(r[o]);e.obj[e.prop]=n}}},arrayToObject=function(t,e){for(var r=e&&e.plainObjects?Object.create(null):{},n=0;n<t.length;++n)void 0!==t[n]&&(r[n]=t[n]);return r},merge=function t(e,r,n){if(!r)return e;if("object"!=typeof r){if(isArray(e))e.push(r);else{if(!e||"object"!=typeof e)return[e,r];(n&&(n.plainObjects||n.allowPrototypes)||!has.call(Object.prototype,r))&&(e[r]=!0)}return e}if(!e||"object"!=typeof e)return[e].concat(r);var o=e;return isArray(e)&&!isArray(r)&&(o=arrayToObject(e,n)),isArray(e)&&isArray(r)?(r.forEach((function(r,o){if(has.call(e,o)){var i=e[o];i&&"object"==typeof i&&r&&"object"==typeof r?e[o]=t(i,r,n):e.push(r)}else e[o]=r})),e):Object.keys(r).reduce((function(e,o){var i=r[o];return has.call(e,o)?e[o]=t(e[o],i,n):e[o]=i,e}),o)},assign=function(t,e){return Object.keys(e).reduce((function(t,r){return t[r]=e[r],t}),t)},decode=function(t,e,r){var n=t.replace(/\+/g," ");if("iso-8859-1"===r)return n.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(n)}catch(t){return n}},encode=function(t,e,r){if(0===t.length)return t;var n=t;if("symbol"==typeof t?n=Symbol.prototype.toString.call(t):"string"!=typeof t&&(n=String(t)),"iso-8859-1"===r)return escape(n).replace(/%u[0-9a-f]{4}/gi,(function(t){return"%26%23"+parseInt(t.slice(2),16)+"%3B"}));for(var o="",i=0;i<n.length;++i){var a=n.charCodeAt(i);45===a||46===a||95===a||126===a||a>=48&&a<=57||a>=65&&a<=90||a>=97&&a<=122?o+=n.charAt(i):a<128?o+=hexTable[a]:a<2048?o+=hexTable[192|a>>6]+hexTable[128|63&a]:a<55296||a>=57344?o+=hexTable[224|a>>12]+hexTable[128|a>>6&63]+hexTable[128|63&a]:(i+=1,a=65536+((1023&a)<<10|1023&n.charCodeAt(i)),o+=hexTable[240|a>>18]+hexTable[128|a>>12&63]+hexTable[128|a>>6&63]+hexTable[128|63&a])}return o},compact=function(t){for(var e=[{obj:{o:t},prop:"o"}],r=[],n=0;n<e.length;++n)for(var o=e[n],i=o.obj[o.prop],a=Object.keys(i),s=0;s<a.length;++s){var c=a[s],u=i[c];"object"==typeof u&&null!==u&&-1===r.indexOf(u)&&(e.push({obj:i,prop:c}),r.push(u))}return compactQueue(e),t},isRegExp=function(t){return"[object RegExp]"===Object.prototype.toString.call(t)},isBuffer=function(t){return!(!t||"object"!=typeof t)&&!!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t))},combine=function(t,e){return[].concat(t,e)},utils={arrayToObject:arrayToObject,assign:assign,combine:combine,compact:compact,decode:decode,encode:encode,isBuffer:isBuffer,isRegExp:isRegExp,merge:merge},replace$1=String.prototype.replace,percentTwenties=/%20/g,Format={RFC1738:"RFC1738",RFC3986:"RFC3986"},formats=utils.assign({default:Format.RFC3986,formatters:{RFC1738:function(t){return replace$1.call(t,percentTwenties,"+")},RFC3986:function(t){return String(t)}}},Format),has$1=Object.prototype.hasOwnProperty,arrayPrefixGenerators={brackets:function(t){return t+"[]"},comma:"comma",indices:function(t,e){return t+"["+e+"]"},repeat:function(t){return t}},isArray$1=Array.isArray,push=Array.prototype.push,pushToArray=function(t,e){push.apply(t,isArray$1(e)?e:[e])},toISO=Date.prototype.toISOString,defaultFormat=formats.default,defaults={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:utils.encode,encodeValuesOnly:!1,format:defaultFormat,formatter:formats.formatters[defaultFormat],indices:!1,serializeDate:function(t){return toISO.call(t)},skipNulls:!1,strictNullHandling:!1},isNonNullishPrimitive=function(t){return"string"==typeof t||"number"==typeof t||"boolean"==typeof t||"symbol"==typeof t||"bigint"==typeof t},stringify=function t(e,r,n,o,i,a,s,c,u,l,f,p,h){var d=e;if("function"==typeof s?d=s(r,d):d instanceof Date?d=l(d):"comma"===n&&isArray$1(d)&&(d=d.join(",")),null===d){if(o)return a&&!p?a(r,defaults.encoder,h,"key"):r;d=""}if(isNonNullishPrimitive(d)||utils.isBuffer(d))return a?[f(p?r:a(r,defaults.encoder,h,"key"))+"="+f(a(d,defaults.encoder,h,"value"))]:[f(r)+"="+f(String(d))];var y,m=[];if(void 0===d)return m;if(isArray$1(s))y=s;else{var g=Object.keys(d);y=c?g.sort(c):g}for(var v=0;v<y.length;++v){var w=y[v];i&&null===d[w]||(isArray$1(d)?pushToArray(m,t(d[w],"function"==typeof n?n(r,w):r,n,o,i,a,s,c,u,l,f,p,h)):pushToArray(m,t(d[w],r+(u?"."+w:"["+w+"]"),n,o,i,a,s,c,u,l,f,p,h)))}return m},normalizeStringifyOptions=function(t){if(!t)return defaults;if(null!==t.encoder&&void 0!==t.encoder&&"function"!=typeof t.encoder)throw new TypeError("Encoder has to be a function.");var e=t.charset||defaults.charset;if(void 0!==t.charset&&"utf-8"!==t.charset&&"iso-8859-1"!==t.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var r=formats.default;if(void 0!==t.format){if(!has$1.call(formats.formatters,t.format))throw new TypeError("Unknown format option provided.");r=t.format}var n=formats.formatters[r],o=defaults.filter;return("function"==typeof t.filter||isArray$1(t.filter))&&(o=t.filter),{addQueryPrefix:"boolean"==typeof t.addQueryPrefix?t.addQueryPrefix:defaults.addQueryPrefix,allowDots:void 0===t.allowDots?defaults.allowDots:!!t.allowDots,charset:e,charsetSentinel:"boolean"==typeof t.charsetSentinel?t.charsetSentinel:defaults.charsetSentinel,delimiter:void 0===t.delimiter?defaults.delimiter:t.delimiter,encode:"boolean"==typeof t.encode?t.encode:defaults.encode,encoder:"function"==typeof t.encoder?t.encoder:defaults.encoder,encodeValuesOnly:"boolean"==typeof t.encodeValuesOnly?t.encodeValuesOnly:defaults.encodeValuesOnly,filter:o,formatter:n,serializeDate:"function"==typeof t.serializeDate?t.serializeDate:defaults.serializeDate,skipNulls:"boolean"==typeof t.skipNulls?t.skipNulls:defaults.skipNulls,sort:"function"==typeof t.sort?t.sort:null,strictNullHandling:"boolean"==typeof t.strictNullHandling?t.strictNullHandling:defaults.strictNullHandling}},stringify_1=function(t,e){var r,n=t,o=normalizeStringifyOptions(e);"function"==typeof o.filter?n=(0,o.filter)("",n):isArray$1(o.filter)&&(r=o.filter);var i,a=[];if("object"!=typeof n||null===n)return"";i=e&&e.arrayFormat in arrayPrefixGenerators?e.arrayFormat:e&&"indices"in e?e.indices?"indices":"repeat":"indices";var s=arrayPrefixGenerators[i];r||(r=Object.keys(n)),o.sort&&r.sort(o.sort);for(var c=0;c<r.length;++c){var u=r[c];o.skipNulls&&null===n[u]||pushToArray(a,stringify(n[u],u,s,o.strictNullHandling,o.skipNulls,o.encode?o.encoder:null,o.filter,o.sort,o.allowDots,o.serializeDate,o.formatter,o.encodeValuesOnly,o.charset))}var l=a.join(o.delimiter),f=!0===o.addQueryPrefix?"?":"";return o.charsetSentinel&&("iso-8859-1"===o.charset?f+="utf8=%26%2310003%3B&":f+="utf8=%E2%9C%93&"),l.length>0?f+l:""},has$2=Object.prototype.hasOwnProperty,isArray$2=Array.isArray,defaults$1={allowDots:!1,allowPrototypes:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:utils.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},interpretNumericEntities=function(t){return t.replace(/&#(\d+);/g,(function(t,e){return String.fromCharCode(parseInt(e,10))}))},isoSentinel="utf8=%26%2310003%3B",charsetSentinel="utf8=%E2%9C%93",parseValues=function(t,e){var r,n={},o=e.ignoreQueryPrefix?t.replace(/^\?/,""):t,i=e.parameterLimit===1/0?void 0:e.parameterLimit,a=o.split(e.delimiter,i),s=-1,c=e.charset;if(e.charsetSentinel)for(r=0;r<a.length;++r)0===a[r].indexOf("utf8=")&&(a[r]===charsetSentinel?c="utf-8":a[r]===isoSentinel&&(c="iso-8859-1"),s=r,r=a.length);for(r=0;r<a.length;++r)if(r!==s){var u,l,f=a[r],p=f.indexOf("]="),h=-1===p?f.indexOf("="):p+1;-1===h?(u=e.decoder(f,defaults$1.decoder,c,"key"),l=e.strictNullHandling?null:""):(u=e.decoder(f.slice(0,h),defaults$1.decoder,c,"key"),l=e.decoder(f.slice(h+1),defaults$1.decoder,c,"value")),l&&e.interpretNumericEntities&&"iso-8859-1"===c&&(l=interpretNumericEntities(l)),l&&"string"==typeof l&&e.comma&&l.indexOf(",")>-1&&(l=l.split(",")),f.indexOf("[]=")>-1&&(l=isArray$2(l)?[l]:l),has$2.call(n,u)?n[u]=utils.combine(n[u],l):n[u]=l}return n},parseObject=function(t,e,r){for(var n=e,o=t.length-1;o>=0;--o){var i,a=t[o];if("[]"===a&&r.parseArrays)i=[].concat(n);else{i=r.plainObjects?Object.create(null):{};var s="["===a.charAt(0)&&"]"===a.charAt(a.length-1)?a.slice(1,-1):a,c=parseInt(s,10);r.parseArrays||""!==s?!isNaN(c)&&a!==s&&String(c)===s&&c>=0&&r.parseArrays&&c<=r.arrayLimit?(i=[])[c]=n:i[s]=n:i={0:n}}n=i}return n},parseKeys=function(t,e,r){if(t){var n=r.allowDots?t.replace(/\.([^.[]+)/g,"[$1]"):t,o=/(\[[^[\]]*])/g,i=r.depth>0&&/(\[[^[\]]*])/.exec(n),a=i?n.slice(0,i.index):n,s=[];if(a){if(!r.plainObjects&&has$2.call(Object.prototype,a)&&!r.allowPrototypes)return;s.push(a)}for(var c=0;r.depth>0&&null!==(i=o.exec(n))&&c<r.depth;){if(c+=1,!r.plainObjects&&has$2.call(Object.prototype,i[1].slice(1,-1))&&!r.allowPrototypes)return;s.push(i[1])}return i&&s.push("["+n.slice(i.index)+"]"),parseObject(s,e,r)}},normalizeParseOptions=function(t){if(!t)return defaults$1;if(null!==t.decoder&&void 0!==t.decoder&&"function"!=typeof t.decoder)throw new TypeError("Decoder has to be a function.");if(void 0!==t.charset&&"utf-8"!==t.charset&&"iso-8859-1"!==t.charset)throw new Error("The charset option must be either utf-8, iso-8859-1, or undefined");var e=void 0===t.charset?defaults$1.charset:t.charset;return{allowDots:void 0===t.allowDots?defaults$1.allowDots:!!t.allowDots,allowPrototypes:"boolean"==typeof t.allowPrototypes?t.allowPrototypes:defaults$1.allowPrototypes,arrayLimit:"number"==typeof t.arrayLimit?t.arrayLimit:defaults$1.arrayLimit,charset:e,charsetSentinel:"boolean"==typeof t.charsetSentinel?t.charsetSentinel:defaults$1.charsetSentinel,comma:"boolean"==typeof t.comma?t.comma:defaults$1.comma,decoder:"function"==typeof t.decoder?t.decoder:defaults$1.decoder,delimiter:"string"==typeof t.delimiter||utils.isRegExp(t.delimiter)?t.delimiter:defaults$1.delimiter,depth:"number"==typeof t.depth||!1===t.depth?+t.depth:defaults$1.depth,ignoreQueryPrefix:!0===t.ignoreQueryPrefix,interpretNumericEntities:"boolean"==typeof t.interpretNumericEntities?t.interpretNumericEntities:defaults$1.interpretNumericEntities,parameterLimit:"number"==typeof t.parameterLimit?t.parameterLimit:defaults$1.parameterLimit,parseArrays:!1!==t.parseArrays,plainObjects:"boolean"==typeof t.plainObjects?t.plainObjects:defaults$1.plainObjects,strictNullHandling:"boolean"==typeof t.strictNullHandling?t.strictNullHandling:defaults$1.strictNullHandling}},parse=function(t,e){var r=normalizeParseOptions(e);if(""===t||null==t)return r.plainObjects?Object.create(null):{};for(var n="string"==typeof t?parseValues(t,r):t,o=r.plainObjects?Object.create(null):{},i=Object.keys(n),a=0;a<i.length;++a){var s=i[a],c=parseKeys(s,n[s],r);o=utils.merge(o,c,r)}return utils.compact(o)},lib={formats:formats,parse:parse,stringify:stringify_1},MonitorConsumer=function(){function t(t,e,r,n){if(void 0===e&&(e=!0),void 0===r&&(r="image"),this.abnormalBreaker=new CircuitBreaker("5/60",300,"0/60"),"custom"===r&&!n)throw Error("When using custom mode, the custom function cannot be empty!");"beacon"!==r||window.navigator.sendBeacon||(r="fetch"),this.api=t,this.emitType=r,this.zip=e,this.func=n}return t.prototype.setAbnormalBreaker=function(t){this.abnormalBreaker=t},t.prototype.consume=function(t){return __awaiter(this,void 0,void 0,(function(){var e;return __generator(this,(function(r){switch(r.label){case 0:if(!this.abnormalBreaker.canPass())return[2];e={data:encodeURIComponent(t)},this.zip&&"image"!=this.emitType&&e.data.length>infoLenMax&&(e.data=pako.gzip(e.data,{to:"string"}),e.zip=!0),r.label=1;case 1:switch(r.trys.push([1,12,,13]),this.emitType){case"image":return[3,2];case"fetch":return[3,4];case"beacon":return[3,6];case"custom":return[3,8]}return[3,11];case 2:return[4,this.imageConsume(e)];case 3:return r.sent(),[3,11];case 4:return[4,this.fetchConsume(e)];case 5:return r.sent(),[3,11];case 6:return[4,this.beaconConsume(e)];case 7:return r.sent(),[3,11];case 8:return this.func?[4,this.func(e)]:[3,10];case 9:r.sent(),r.label=10;case 10:r.label=11;case 11:return[3,13];case 12:return r.sent(),this.abnormalBreaker.count(),[3,13];case 13:return[2]}}))}))},t.prototype.imageConsume=function(t){var e=this,r=new Image(1,1);return new Promise((function(n,o){r.onerror=function(t){o(t)},r.onload=function(t){n(t)},r.onabort=function(t){o(t)};var i=[];for(var a in t)i.push(a+"="+t[a]);r.src=e.api+"?"+i.join("&")}))},t.prototype.fetchConsume=function(t){return axios.post(this.api,lib.stringify(t),{headers:{"Content-Type":"application/x-www-form-urlencoded"}})},t.prototype.beaconConsume=function(t){var e=this;if(!window||!window.navigator||"function"!=typeof window.navigator.sendBeacon)return!1;var r=new FormData;for(var n in t)r.append(n,t[n]);return new Promise((function(t,n){window.navigator.sendBeacon(e.api,r)?t():n()}))},__decorate([before,after],t.prototype,"consume",null),t}(),Store=function(){function t(t){this.appName=t,this.store=localForage.createInstance({name:t,storeName:t})}return t.prototype.destory=function(){this.store.dropInstance({name:this.appName,storeName:this.appName})},t.prototype.shiftMore=function(t){return void 0===t&&(t=10),__awaiter(this,void 0,void 0,(function(){var e,r,n,o;return __generator(this,(function(i){switch(i.label){case 0:return e=[],[4,this.length()];case 1:r=i.sent(),r=t>r?r:t,i.label=2;case 2:return--r>-1?(o=(n=e).push,[4,this._shift()]):[3,4];case 3:return o.apply(n,[i.sent()]),[3,2];case 4:return 0===e.length?[2,""]:[2,e=JSON.stringify(e)]}}))}))},t.prototype._shift=function(){return __awaiter(this,void 0,void 0,(function(){var t,e;return __generator(this,(function(r){switch(r.label){case 0:return t="",[4,this.keys()];case 1:return e=r.sent().shift()||"",[4,this.store.getItem(e)];case 2:return t=r.sent(),[4,this.store.removeItem(e)];case 3:return r.sent(),[2,t]}}))}))},t.prototype.push=function(t){return __awaiter(this,void 0,void 0,(function(){var e;return __generator(this,(function(r){switch(r.label){case 0:return e=this.appName+"_"+(new Date).getTime(),[4,this.store.setItem(e,t)];case 1:return r.sent(),[2]}}))}))},t.prototype.length=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:return[4,this.store.length()];case 1:return[2,t.sent()]}}))}))},t.prototype.clear=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:return[4,this.store.clear()];case 1:return[2,t.sent()]}}))}))},t.prototype.keys=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:return[4,this.store.keys()];case 1:return[2,t.sent()]}}))}))},t.prototype.iterate=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,this.store.iterate(t)];case 1:return[2,e.sent()]}}))}))},t.prototype.customDriver=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){return this.store.defineDriver(t),[2]}))}))},t}(),AbstractHook=function(t){this.provider=t},ErrorHook=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.listener=function(t){if(t.stopPropagation(),t.preventDefault(),t.target instanceof HTMLImageElement||t.target instanceof HTMLScriptElement||t.target instanceof HTMLLinkElement){var e=t.target instanceof HTMLImageElement||t.target instanceof HTMLScriptElement?t.target.src:t.target instanceof HTMLLinkElement?t.target.href:"";this.provider.track(__assign(__assign({},getBasicInfo()),{msg:t.target.outerHTML,file:e,stack:t.target.localName.toUpperCase(),line:0,col:0,ms:"error",ml:"error"}))}else{var r="";if(t.error&&t.error.stack)r=t.error.stack.toString();else if(arguments){for(var n=[],o=arguments.callee.caller,i=3;o&&--i>0&&(n.push(o.toString()),o!==o.caller);)o=o.caller;r=n.join(",")}this.provider.track(__assign(__assign({},getBasicInfo()),{file:t.filename,line:t.lineno,col:t.colno,stack:r,msg:t.message,ms:"error",ml:"error"}))}},e.prototype.watch=function(){on("error",this.listener.bind(this))},e.prototype.unwatch=function(){off("error",this.listener.bind(this))},e}(AbstractHook),actions=["click","input","blur"],ActionHook=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.getCurrentElement=function(t){var e=t.outerHTML.match("<.+?>");return e&&e[0]||""},e.prototype.listener=function(t){t instanceof MouseEvent?this.provider.track(__assign(__assign({},getBasicInfo()),{msg:t.target instanceof HTMLElement?this.getCurrentElement(t.target):"",ms:"action",ml:"info",at:t.type,el:t.target instanceof HTMLElement?this.getCurrentElement(t.target):void 0,x:t.x,y:t.y})):t instanceof FocusEvent?this.provider.track(__assign(__assign({},getBasicInfo()),{msg:t.target instanceof HTMLElement?this.getCurrentElement(t.target):"",ms:"action",ml:"info",at:t.type,el:t.target instanceof HTMLElement?this.getCurrentElement(t.target):void 0})):t instanceof KeyboardEvent?this.provider.track(__assign(__assign({},getBasicInfo()),{msg:t.type+" "+t.key,ms:"action",ml:"info",at:t.type,key:t.key})):t instanceof InputEvent&&this.provider.track(__assign(__assign({},getBasicInfo()),{msg:t.inputType+" "+t.data,ms:"action",ml:"info",at:t.type,key:t.data||""}))},e.prototype.watch=function(){var t,e;try{for(var r=__values(actions),n=r.next();!n.done;n=r.next()){on(n.value,this.listener.bind(this))}}catch(e){t={error:e}}finally{try{n&&!n.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}},e.prototype.unwatch=function(){var t,e;try{for(var r=__values(actions),n=r.next();!n.done;n=r.next()){off(n.value,this.listener.bind(this))}}catch(e){t={error:e}}finally{try{n&&!n.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}},e}(AbstractHook),UncaughtHook=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.listener=function(t){t.stopPropagation(),t.preventDefault(),this.provider.track(__assign(__assign({},getBasicInfo()),{msg:t.reason,ms:"uncaught",ml:"error"}))},e.prototype.watch=function(){on("unhandledrejection",this.listener.bind(this))},e.prototype.unwatch=function(){off("unhandledrejection",this.listener.bind(this))},e}(AbstractHook),SPARouterHook=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.hackState=function(t){replace(history,t,(function(e,r,n){replace(window,"onpopstate",(function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return window._replace_center_.onpopstate.apply(this,e)}));var o=location.href,i=window._replace_center_[t].apply(history,[e,r,n]);if(!n||n===o)return i;try{var a=o.split("#"),s=n.split("#"),c=parseUrl(a[0]),u=parseUrl(s[0]),l=a[1]&&a[1].replace(/^\/?(.*)/,"$1"),f=s[1]&&s[1].replace(/^\/?(.*)/,"$1");c!==u?dispatchCustomEvent("historystatechanged",u):l!==f&&dispatchCustomEvent("historystatechanged",f)}catch(t){}return i}))},e.prototype.dehackState=function(t){reduction(history,t),reduction(window,"onpopstate")},e.prototype.handleHashchange=function(t){var e=parseHash(location.hash.toLowerCase());pv(this.provider,e)},e.prototype.handleHistorystatechange=function(t){var e=parseHash(t.detail.toLowerCase());pv(this.provider,e)},e.prototype.watch=function(){this.hackState("pushState"),this.hackState("replaceState"),on("hashchange",this.handleHashchange.bind(this)),on("historystatechanged",this.handleHistorystatechange.bind(this))},e.prototype.unwatch=function(){this.dehackState("pushState"),this.dehackState("replaceState"),off("hashchange",this.handleHashchange.bind(this)),off("historystatechanged",this.handleHistorystatechange.bind(this))},e}(AbstractHook),PerformanceHook=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.listener=function(t){var e=this;setTimeout((function(){e.provider.track(__assign(__assign(__assign({},getBasicInfo()),perforPage()),{ms:"performance",ml:"info"}))}),20)},e.prototype.watch=function(){on("load",this.listener.bind(this))},e.prototype.unwatch=function(){off("load",this.listener.bind(this))},e}(AbstractHook),HooksFactory=function(){function t(){this.hooks=new Map}return t.prototype.reigster=function(t,e){for(var r,n=this.hooks.keys();!(r=n.next()).done;)if(r.value===t)throw TypeError('the hook type "'+t+'" already exists！');return this.hooks.set(t,e),this},t.prototype.watch=function(t){var e;if(!this.hooks.has(t))throw TypeError('hook type "'+t+'" does not exist, please register first！');return null===(e=this.hooks.get(t))||void 0===e||e.watch(),this},t.prototype.unwatch=function(t){var e;if(!this.hooks.has(t))throw TypeError('hook type "'+t+'" does not exist, please register first！');return null===(e=this.hooks.get(t))||void 0===e||e.unwatch(),this},t.prototype.initlize=function(t){return this.reigster("error",new ErrorHook(t)),this.reigster("uncaught",new UncaughtHook(t)),this.reigster("action",new ActionHook(t)),this.reigster("spa",new SPARouterHook(t)),this.reigster("performance",new PerformanceHook(t)),this},t}(),MonitorCenter=function(){function t(t){this.consumers=[],this.store=new Store(t),this.provider=new MonitorProvider(this.store),this.hooks=(new HooksFactory).initlize(this.provider),pv(this.provider)}return t.prototype.start=function(t,e){var r=this;void 0===t&&(t=15e3),this.timer&&clearInterval(this.timer),this.timer=window.setInterval((function(){return __awaiter(r,void 0,void 0,(function(){var t;return __generator(this,(function(r){switch(r.label){case 0:return[4,this.store.shiftMore(e)];case 1:return(t=r.sent())&&this.consumers.forEach((function(e){e.consume(t)})),[2]}}))}))}),t)},t.prototype.stop=function(){clearInterval(this.timer),this.timer=void 0},t.prototype.subscribe=function(t,e,r,n){return this.consumers.push(new MonitorConsumer(t,e,r,n)),this.consumers[this.consumers.length-1]},t.prototype.getStore=function(){return this.store},t.prototype.getProvider=function(){return this.provider},t}();exports.AbstractHook=AbstractHook,exports.CircuitBreaker=CircuitBreaker,exports.MonitorCenter=MonitorCenter,exports.lifeCycle=lifeCycle;
