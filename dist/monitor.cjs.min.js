"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var axios=_interopDefault(require("axios")),pako=_interopDefault(require("pako")),localForage=_interopDefault(require("localforage")),extendStatics=function(e,t){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};function __extends(e,t){function r(){this.constructor=e}extendStatics(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var __assign=function(){return(__assign=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function __decorate(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a}function __awaiter(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new r((function(t){t(e.value)})).then(a,s)}c((n=n.apply(e,t||[])).next())}))}function __generator(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}function __read(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(e){o={error:e}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a}function __spread(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(__read(arguments[t]));return e}var lifeCycle={consume:{before:function(){},after:function(){}},track:{before:function(){},after:function(){}}};function before(e,t,r){return{value:function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return lifeCycle[t]&&lifeCycle[t].before.apply(this,e),r.value.apply(this,e)}}}function after(e,t,r){return{value:function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return __awaiter(this,void 0,void 0,(function(){var n;return __generator(this,(function(o){switch(o.label){case 0:return[4,r.value.apply(this,e)];case 1:return n=o.sent(),lifeCycle[t]&&lifeCycle[t].after.apply(this,[n]),[2,n]}}))}))}}}function replace(e,t,r,n){var o=window||global||void 0;if(!o)throw new ReferenceError("the top object is not exist");o._replace_center_||(o._replace_center_={});var i=n?o._replace_center_[n]?o._replace_center_[n]:o._replace_center_[n]={}:o._replace_center_;i[t]||(i[t]=e[t],e[t]=r)}function reduction(e,t,r){var n=window||global||void 0;if(!n)throw new ReferenceError("the top object is not exist");n._replace_center_||(n._replace_center_={});var o=r?n._replace_center_[r]?n._replace_center_[r]:n._replace_center_[r]={}:n._replace_center_;n._replace_center_[t]&&(e[t]=o[t],delete o[t])}var expiredays=864e5,infoLenMax=1e3;function getBasicInfo(){return __assign(__assign(__assign({},getUniqueInfo()),getConnection()),{page:window.location.href,uId:getCookie("uId")||"",rId:getCookie("rId")||"",dId:getCookie("deviceId")||"",dt:getCookie("deviceType")||"",sys:getCookie("sys")||"",sv:getCookie("sysVersion")||"",sw:getScreen().w,sh:getScreen().h,v:"1.1.10"})}function getScreen(){return{w:document.documentElement.clientWidth||document.body.clientWidth,h:document.documentElement.clientHeight||document.body.clientHeight}}function randomString(e){e=e||10;for(var t="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz123456789",r=t.length,n="",o=0;o<e;o++)n+=t.charAt(Math.floor(Math.random()*r));return n+"_"+(new Date).getTime()}function getCookie(e){var t,r=new RegExp("(^| )"+e+"=([^;]*)(;|$)");return(t=document.cookie.match(r))?t[2]:null}function getUniqueInfo(){var e=getCookie("uni");if(!e){e=randomString(10);var t=new Date;t.setDate(t.getDate()+expiredays),document.cookie="uni="+e+";domain="+document.domain+";path=/;expires="+t.toGMTString()}return{uni:e}}function perforPage(){if(!window.performance)return{};var e=performance.timing;return{dnst:e.domainLookupEnd-e.domainLookupStart||0,tcpt:e.connectEnd-e.connectStart||0,wit:e.responseStart-e.navigationStart||0,domt:e.domContentLoadedEventEnd-e.navigationStart||0,lodt:e.loadEventEnd-e.navigationStart||0,radt:e.fetchStart-e.navigationStart||0,rdit:e.redirectEnd-e.redirectStart||0,uodt:e.unloadEventEnd-e.unloadEventStart||0,reqt:e.responseEnd-e.requestStart||0,andt:e.domComplete-e.domInteractive||0}}function getConnection(){var e=navigator.connection;if(!e)return{ct:navigator.onLine?"online":"offline"};var t=e.rtt,r=e.downlink;return{ct:e.effectiveType,cs:r+"Mb/s",cr:t+"ms",csa:e.saveData}}function on(e,t){window.addEventListener&&window.addEventListener(e,t,!0),window.attachEvent&&window.attachEvent("on"+e,t)}function off(e,t){window.removeEventListener&&window.removeEventListener(e,t),window.detachEvent&&window.detachEvent(e,t)}function dispatchCustomEvent(e,t){var r;CustomEvent?r=new CustomEvent(e,{detail:t}):((r=window.document.createEvent("HTMLEvents")).initEvent(e,!1,!0),r.detail=t),window.dispatchEvent(r)}function parseHash(e){return(e?parseUrl(e.replace(/^#\/?/,"")):"")||"[index]"}function parseUrl(e){return e.replace(/^(https?:)?\/\//,"").replace(/\?.*$/,"")}function pv(e,t){e.track({dot:document.title,dol:location.href,dr:document.referrer,dpr:window.devicePixelRatio,de:document.charset,page:t||window.location.href,msg:"",ms:"pv",ml:"info"})}var MonitorProvider=function(){function e(e){this.store=e}return e.prototype.mountStore=function(e){this.store=e},e.prototype.track=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return e=__assign(__assign(__assign({},getBasicInfo()),getConnection()),e),this.store&&this.store.push(e),[2,this]}))}))},__decorate([before,after],e.prototype,"track",null),e}(),Counter=function(){function e(e){this.nums=[],this.reserved=e}return e.prototype.get=function(){var e=this,t=Date.now();return this.nums=this.nums.filter((function(r){return r>t-1e3*e.reserved})),this.nums.length},e.prototype.increase=function(){var e=this,t=Date.now();this.nums=this.nums.filter((function(r){return r>t-1e3*e.reserved})),this.nums.push(Date.now())},e.prototype.decrease=function(){this.nums.shift()},e.prototype.reset=function(){this.nums=[]},e}(),AbstractState=function(){function e(e){void 0===e&&(e=Date.now()),this.startTime=e}return e.prototype.canPass=function(e){return!0},e.prototype.checkout=function(e){},e}(),HalfOpenState=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.canPass=function(e){var t=parseInt(e.thresholdForHalfOpen[0]);return e.getCount()<=t},t.prototype.checkout=function(e){e.getCount()>parseInt(e.thresholdForHalfOpen[0])?e.setState(new OpenState):e.setState(new CloseState)},t}(AbstractState),OpenState=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.canPass=function(){return!1},t.prototype.checkout=function(e){var t=1e3*e.idleTimeForOpen;Date.now()>=this.startTime+t&&e.setState(new HalfOpenState)},t}(AbstractState),CloseState=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.canPass=function(e){return!0},t.prototype.checkout=function(e){e.getCount()>=parseInt(e.thresholdForOpen[0])&&e.setState(new OpenState)},t}(AbstractState),CircuitBreaker=function(){function e(e,t,r){void 0===e&&(e="1/60"),void 0===t&&(t=300),void 0===r&&(r="1/60"),this.idleTimeForOpen=t,this.thresholdForOpen=e.split("/"),this.thresholdForHalfOpen=r.split("/"),this.counter=new Counter(Math.max(parseInt(this.thresholdForOpen[1]),parseInt(this.thresholdForHalfOpen[1]))),this.state=new CloseState}return e.prototype.getStateName=function(){return/^function\s(.*)\(/.exec(this.state.constructor+""),RegExp.$1},e.prototype.getState=function(){return this.state},e.prototype.setState=function(e){this.state=e},e.prototype.reset=function(){this.counter.reset()},e.prototype.canPass=function(){return this.getState().checkout(this),this.getState().canPass(this)},e.prototype.count=function(){this.counter.increase()},e.prototype.getCount=function(){return this.counter.get()},e.prototype.getDuration=function(){return(Date.now()-this.state.startTime)/1e3},e}(),has=Object.prototype.hasOwnProperty,isArray=Array.isArray,hexTable=function(){for(var e=[],t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e}(),compactQueue=function(e){for(;e.length>1;){var t=e.pop(),r=t.obj[t.prop];if(isArray(r)){for(var n=[],o=0;o<r.length;++o)void 0!==r[o]&&n.push(r[o]);t.obj[t.prop]=n}}},arrayToObject=function(e,t){for(var r=t&&t.plainObjects?Object.create(null):{},n=0;n<e.length;++n)void 0!==e[n]&&(r[n]=e[n]);return r},merge=function e(t,r,n){if(!r)return t;if("object"!=typeof r){if(isArray(t))t.push(r);else{if(!t||"object"!=typeof t)return[t,r];(n&&(n.plainObjects||n.allowPrototypes)||!has.call(Object.prototype,r))&&(t[r]=!0)}return t}if(!t||"object"!=typeof t)return[t].concat(r);var o=t;return isArray(t)&&!isArray(r)&&(o=arrayToObject(t,n)),isArray(t)&&isArray(r)?(r.forEach((function(r,o){if(has.call(t,o)){var i=t[o];i&&"object"==typeof i&&r&&"object"==typeof r?t[o]=e(i,r,n):t.push(r)}else t[o]=r})),t):Object.keys(r).reduce((function(t,o){var i=r[o];return has.call(t,o)?t[o]=e(t[o],i,n):t[o]=i,t}),o)},assign=function(e,t){return Object.keys(t).reduce((function(e,r){return e[r]=t[r],e}),e)},decode=function(e,t,r){var n=e.replace(/\+/g," ");if("iso-8859-1"===r)return n.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(n)}catch(e){return n}},encode=function(e,t,r){if(0===e.length)return e;var n=e;if("symbol"==typeof e?n=Symbol.prototype.toString.call(e):"string"!=typeof e&&(n=String(e)),"iso-8859-1"===r)return escape(n).replace(/%u[0-9a-f]{4}/gi,(function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"}));for(var o="",i=0;i<n.length;++i){var a=n.charCodeAt(i);45===a||46===a||95===a||126===a||a>=48&&a<=57||a>=65&&a<=90||a>=97&&a<=122?o+=n.charAt(i):a<128?o+=hexTable[a]:a<2048?o+=hexTable[192|a>>6]+hexTable[128|63&a]:a<55296||a>=57344?o+=hexTable[224|a>>12]+hexTable[128|a>>6&63]+hexTable[128|63&a]:(i+=1,a=65536+((1023&a)<<10|1023&n.charCodeAt(i)),o+=hexTable[240|a>>18]+hexTable[128|a>>12&63]+hexTable[128|a>>6&63]+hexTable[128|63&a])}return o},compact=function(e){for(var t=[{obj:{o:e},prop:"o"}],r=[],n=0;n<t.length;++n)for(var o=t[n],i=o.obj[o.prop],a=Object.keys(i),s=0;s<a.length;++s){var c=a[s],u=i[c];"object"==typeof u&&null!==u&&-1===r.indexOf(u)&&(t.push({obj:i,prop:c}),r.push(u))}return compactQueue(t),e},isRegExp=function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},isBuffer=function(e){return!(!e||"object"!=typeof e)&&!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))},combine=function(e,t){return[].concat(e,t)},utils={arrayToObject:arrayToObject,assign:assign,combine:combine,compact:compact,decode:decode,encode:encode,isBuffer:isBuffer,isRegExp:isRegExp,merge:merge},replace$1=String.prototype.replace,percentTwenties=/%20/g,Format={RFC1738:"RFC1738",RFC3986:"RFC3986"},formats=utils.assign({default:Format.RFC3986,formatters:{RFC1738:function(e){return replace$1.call(e,percentTwenties,"+")},RFC3986:function(e){return String(e)}}},Format),has$1=Object.prototype.hasOwnProperty,arrayPrefixGenerators={brackets:function(e){return e+"[]"},comma:"comma",indices:function(e,t){return e+"["+t+"]"},repeat:function(e){return e}},isArray$1=Array.isArray,push=Array.prototype.push,pushToArray=function(e,t){push.apply(e,isArray$1(t)?t:[t])},toISO=Date.prototype.toISOString,defaultFormat=formats.default,defaults={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:utils.encode,encodeValuesOnly:!1,format:defaultFormat,formatter:formats.formatters[defaultFormat],indices:!1,serializeDate:function(e){return toISO.call(e)},skipNulls:!1,strictNullHandling:!1},isNonNullishPrimitive=function(e){return"string"==typeof e||"number"==typeof e||"boolean"==typeof e||"symbol"==typeof e||"bigint"==typeof e},stringify=function e(t,r,n,o,i,a,s,c,u,l,f,p,h){var d=t;if("function"==typeof s?d=s(r,d):d instanceof Date?d=l(d):"comma"===n&&isArray$1(d)&&(d=d.join(",")),null===d){if(o)return a&&!p?a(r,defaults.encoder,h,"key"):r;d=""}if(isNonNullishPrimitive(d)||utils.isBuffer(d))return a?[f(p?r:a(r,defaults.encoder,h,"key"))+"="+f(a(d,defaults.encoder,h,"value"))]:[f(r)+"="+f(String(d))];var y,m=[];if(void 0===d)return m;if(isArray$1(s))y=s;else{var v=Object.keys(d);y=c?v.sort(c):v}for(var g=0;g<y.length;++g){var w=y[g];i&&null===d[w]||(isArray$1(d)?pushToArray(m,e(d[w],"function"==typeof n?n(r,w):r,n,o,i,a,s,c,u,l,f,p,h)):pushToArray(m,e(d[w],r+(u?"."+w:"["+w+"]"),n,o,i,a,s,c,u,l,f,p,h)))}return m},normalizeStringifyOptions=function(e){if(!e)return defaults;if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw new TypeError("Encoder has to be a function.");var t=e.charset||defaults.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var r=formats.default;if(void 0!==e.format){if(!has$1.call(formats.formatters,e.format))throw new TypeError("Unknown format option provided.");r=e.format}var n=formats.formatters[r],o=defaults.filter;return("function"==typeof e.filter||isArray$1(e.filter))&&(o=e.filter),{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:defaults.addQueryPrefix,allowDots:void 0===e.allowDots?defaults.allowDots:!!e.allowDots,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:defaults.charsetSentinel,delimiter:void 0===e.delimiter?defaults.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:defaults.encode,encoder:"function"==typeof e.encoder?e.encoder:defaults.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:defaults.encodeValuesOnly,filter:o,formatter:n,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:defaults.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:defaults.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:defaults.strictNullHandling}},stringify_1=function(e,t){var r,n=e,o=normalizeStringifyOptions(t);"function"==typeof o.filter?n=(0,o.filter)("",n):isArray$1(o.filter)&&(r=o.filter);var i,a=[];if("object"!=typeof n||null===n)return"";i=t&&t.arrayFormat in arrayPrefixGenerators?t.arrayFormat:t&&"indices"in t?t.indices?"indices":"repeat":"indices";var s=arrayPrefixGenerators[i];r||(r=Object.keys(n)),o.sort&&r.sort(o.sort);for(var c=0;c<r.length;++c){var u=r[c];o.skipNulls&&null===n[u]||pushToArray(a,stringify(n[u],u,s,o.strictNullHandling,o.skipNulls,o.encode?o.encoder:null,o.filter,o.sort,o.allowDots,o.serializeDate,o.formatter,o.encodeValuesOnly,o.charset))}var l=a.join(o.delimiter),f=!0===o.addQueryPrefix?"?":"";return o.charsetSentinel&&("iso-8859-1"===o.charset?f+="utf8=%26%2310003%3B&":f+="utf8=%E2%9C%93&"),l.length>0?f+l:""},has$2=Object.prototype.hasOwnProperty,isArray$2=Array.isArray,defaults$1={allowDots:!1,allowPrototypes:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:utils.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},interpretNumericEntities=function(e){return e.replace(/&#(\d+);/g,(function(e,t){return String.fromCharCode(parseInt(t,10))}))},isoSentinel="utf8=%26%2310003%3B",charsetSentinel="utf8=%E2%9C%93",parseValues=function(e,t){var r,n={},o=t.ignoreQueryPrefix?e.replace(/^\?/,""):e,i=t.parameterLimit===1/0?void 0:t.parameterLimit,a=o.split(t.delimiter,i),s=-1,c=t.charset;if(t.charsetSentinel)for(r=0;r<a.length;++r)0===a[r].indexOf("utf8=")&&(a[r]===charsetSentinel?c="utf-8":a[r]===isoSentinel&&(c="iso-8859-1"),s=r,r=a.length);for(r=0;r<a.length;++r)if(r!==s){var u,l,f=a[r],p=f.indexOf("]="),h=-1===p?f.indexOf("="):p+1;-1===h?(u=t.decoder(f,defaults$1.decoder,c,"key"),l=t.strictNullHandling?null:""):(u=t.decoder(f.slice(0,h),defaults$1.decoder,c,"key"),l=t.decoder(f.slice(h+1),defaults$1.decoder,c,"value")),l&&t.interpretNumericEntities&&"iso-8859-1"===c&&(l=interpretNumericEntities(l)),l&&"string"==typeof l&&t.comma&&l.indexOf(",")>-1&&(l=l.split(",")),f.indexOf("[]=")>-1&&(l=isArray$2(l)?[l]:l),has$2.call(n,u)?n[u]=utils.combine(n[u],l):n[u]=l}return n},parseObject=function(e,t,r){for(var n=t,o=e.length-1;o>=0;--o){var i,a=e[o];if("[]"===a&&r.parseArrays)i=[].concat(n);else{i=r.plainObjects?Object.create(null):{};var s="["===a.charAt(0)&&"]"===a.charAt(a.length-1)?a.slice(1,-1):a,c=parseInt(s,10);r.parseArrays||""!==s?!isNaN(c)&&a!==s&&String(c)===s&&c>=0&&r.parseArrays&&c<=r.arrayLimit?(i=[])[c]=n:i[s]=n:i={0:n}}n=i}return n},parseKeys=function(e,t,r){if(e){var n=r.allowDots?e.replace(/\.([^.[]+)/g,"[$1]"):e,o=/(\[[^[\]]*])/g,i=r.depth>0&&/(\[[^[\]]*])/.exec(n),a=i?n.slice(0,i.index):n,s=[];if(a){if(!r.plainObjects&&has$2.call(Object.prototype,a)&&!r.allowPrototypes)return;s.push(a)}for(var c=0;r.depth>0&&null!==(i=o.exec(n))&&c<r.depth;){if(c+=1,!r.plainObjects&&has$2.call(Object.prototype,i[1].slice(1,-1))&&!r.allowPrototypes)return;s.push(i[1])}return i&&s.push("["+n.slice(i.index)+"]"),parseObject(s,t,r)}},normalizeParseOptions=function(e){if(!e)return defaults$1;if(null!==e.decoder&&void 0!==e.decoder&&"function"!=typeof e.decoder)throw new TypeError("Decoder has to be a function.");if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new Error("The charset option must be either utf-8, iso-8859-1, or undefined");var t=void 0===e.charset?defaults$1.charset:e.charset;return{allowDots:void 0===e.allowDots?defaults$1.allowDots:!!e.allowDots,allowPrototypes:"boolean"==typeof e.allowPrototypes?e.allowPrototypes:defaults$1.allowPrototypes,arrayLimit:"number"==typeof e.arrayLimit?e.arrayLimit:defaults$1.arrayLimit,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:defaults$1.charsetSentinel,comma:"boolean"==typeof e.comma?e.comma:defaults$1.comma,decoder:"function"==typeof e.decoder?e.decoder:defaults$1.decoder,delimiter:"string"==typeof e.delimiter||utils.isRegExp(e.delimiter)?e.delimiter:defaults$1.delimiter,depth:"number"==typeof e.depth||!1===e.depth?+e.depth:defaults$1.depth,ignoreQueryPrefix:!0===e.ignoreQueryPrefix,interpretNumericEntities:"boolean"==typeof e.interpretNumericEntities?e.interpretNumericEntities:defaults$1.interpretNumericEntities,parameterLimit:"number"==typeof e.parameterLimit?e.parameterLimit:defaults$1.parameterLimit,parseArrays:!1!==e.parseArrays,plainObjects:"boolean"==typeof e.plainObjects?e.plainObjects:defaults$1.plainObjects,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:defaults$1.strictNullHandling}},parse=function(e,t){var r=normalizeParseOptions(t);if(""===e||null==e)return r.plainObjects?Object.create(null):{};for(var n="string"==typeof e?parseValues(e,r):e,o=r.plainObjects?Object.create(null):{},i=Object.keys(n),a=0;a<i.length;++a){var s=i[a],c=parseKeys(s,n[s],r);o=utils.merge(o,c,r)}return utils.compact(o)},lib={formats:formats,parse:parse,stringify:stringify_1},MonitorConsumer=function(){function e(e,t,r,n){if(void 0===t&&(t=!0),void 0===r&&(r="image"),this.abnormalBreaker=new CircuitBreaker("5/60",300,"0/60"),"custom"===r&&!n)throw Error("When using custom mode, the custom function cannot be empty!");"beacon"!==r||window.navigator.sendBeacon||(r="fetch"),this.api=e,this.emitType=r,this.zip=t,this.func=n}return e.prototype.setAbnormalBreaker=function(e){this.abnormalBreaker=e},e.prototype.consume=function(e){return __awaiter(this,void 0,void 0,(function(){var t;return __generator(this,(function(r){switch(r.label){case 0:if(!this.abnormalBreaker.canPass())return[2];t={data:encodeURIComponent(e)},this.zip&&"image"!=this.emitType&&t.data.length>infoLenMax&&(t.data=pako.gzip(t.data,{to:"string"}),t.zip=!0),r.label=1;case 1:switch(r.trys.push([1,12,,13]),this.emitType){case"image":return[3,2];case"fetch":return[3,4];case"beacon":return[3,6];case"custom":return[3,8]}return[3,11];case 2:return[4,this.imageConsume(t)];case 3:return r.sent(),[3,11];case 4:return[4,this.fetchConsume(t)];case 5:return r.sent(),[3,11];case 6:return[4,this.beaconConsume(t)];case 7:return r.sent(),[3,11];case 8:return this.func?[4,this.func(t)]:[3,10];case 9:r.sent(),r.label=10;case 10:r.label=11;case 11:return[3,13];case 12:return r.sent(),this.abnormalBreaker.count(),[3,13];case 13:return[2]}}))}))},e.prototype.imageConsume=function(e){var t=this,r=new Image(1,1);return new Promise((function(n,o){r.onerror=function(e){o(e)},r.onload=function(e){n(e)},r.onabort=function(e){o(e)};var i=[];for(var a in e)i.push(a+"="+e[a]);r.src=t.api+"?"+i.join("&")}))},e.prototype.fetchConsume=function(e){return axios.post(this.api,lib.stringify(e),{headers:{"Content-Type":"application/x-www-form-urlencoded"}})},e.prototype.beaconConsume=function(e){var t=this;if(!window||!window.navigator||"function"!=typeof window.navigator.sendBeacon)return!1;var r=new FormData;for(var n in e)r.append(n,e[n]);return new Promise((function(e,n){window.navigator.sendBeacon(t.api,r)?e():n()}))},__decorate([before,after],e.prototype,"consume",null),e}(),Store=function(){function e(e){this.appName=e,this.store=localForage.createInstance({name:e,storeName:e})}return e.prototype.destory=function(){this.store.dropInstance({name:this.appName,storeName:this.appName})},e.prototype.shiftMore=function(e){return void 0===e&&(e=10),__awaiter(this,void 0,void 0,(function(){var t,r,n,o;return __generator(this,(function(i){switch(i.label){case 0:return t=[],[4,this.length()];case 1:r=i.sent(),r=e>r?r:e,i.label=2;case 2:return--r>-1?(o=(n=t).push,[4,this._shift()]):[3,4];case 3:return o.apply(n,[i.sent()]),[3,2];case 4:return 0===t.length?[2,""]:[2,t=JSON.stringify(t)]}}))}))},e.prototype._shift=function(){return __awaiter(this,void 0,void 0,(function(){var e,t;return __generator(this,(function(r){switch(r.label){case 0:return e="",[4,this.keys()];case 1:return t=r.sent().shift()||"",[4,this.store.getItem(t)];case 2:return e=r.sent(),[4,this.store.removeItem(t)];case 3:return r.sent(),[2,e]}}))}))},e.prototype.push=function(e){return __awaiter(this,void 0,void 0,(function(){var t;return __generator(this,(function(r){switch(r.label){case 0:return t=this.appName+"_"+(new Date).getTime(),[4,this.store.setItem(t,e)];case 1:return r.sent(),[2]}}))}))},e.prototype.length=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,this.store.length()];case 1:return[2,e.sent()]}}))}))},e.prototype.clear=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,this.store.clear()];case 1:return[2,e.sent()]}}))}))},e.prototype.keys=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,this.store.keys()];case 1:return[2,e.sent()]}}))}))},e.prototype.iterate=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:return[4,this.store.iterate(e)];case 1:return[2,t.sent()]}}))}))},e.prototype.customDriver=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return this.store.defineDriver(e),[2]}))}))},e}(),AbstractHook=function(e){this.provider=e},ErrorHook=function(e){function t(t){var r=e.call(this,t)||this;return r.handler=r.listener.bind(r),r}return __extends(t,e),t.prototype.onError=function(e,t,r,n,o){return setTimeout((function(){var i;if(o&&o.stack)i=o.stack.toString();else if(arguments.callee){for(var a=[],s=arguments.callee.caller,c=3;s&&--c>0&&(a.push(s.toString()),s!==s.caller);)s=s.caller;i=a.join(",")}(e||o)&&this.provider.track({file:t,line:r,col:n,stack:i,msg:o.message,ms:"error",ml:"error"})}),0),!0},t.prototype.listener=function(e){if(e.stopPropagation(),e.preventDefault(),e.target instanceof HTMLImageElement||e.target instanceof HTMLScriptElement||e.target instanceof HTMLLinkElement){var t=e.target instanceof HTMLImageElement||e.target instanceof HTMLScriptElement?e.target.src:e.target instanceof HTMLLinkElement?e.target.href:"";this.provider.track({msg:e.target.outerHTML,file:t,stack:e.target.localName.toUpperCase(),line:0,col:0,ms:"error",ml:"error"})}},t.prototype.watch=function(){replace(window,"onerror",this.onError),on("error",this.handler)},t.prototype.unwatch=function(){reduction(window,"onerror"),off("error",this.handler)},t}(AbstractHook),ActionEvent=function(){},NodeEventHandlerMap=function(){},ActionHook=function(e){function t(t){var r=e.call(this,t)||this;return r.handlerMap=[],r.observer=new MutationObserver((function(e,t){e.forEach((function(e){r.nodeBindActionHandler(e.target)}))})),r.observer.observe(window.document,{subtree:!0,childList:!0,attributes:!0,attributeFilter:["jr-event","jr-msg","jr-area"]}),r}return __extends(t,e),t.prototype.nodeBindActionHandler=function(e){var t=this;e.childNodes&&e.childNodes.forEach((function(e){t.nodeBindActionHandler(e)}));for(var r=[],n=e.attributes||[],o=0,i=n.length;o<i;++o){var a=void 0;if((a=n instanceof NamedNodeMap?n.item(o):n[o])&&"jr-event"===a.name)a.value.split(";").forEach((function(e){var t=new ActionEvent;t.event=e,r.push(t)}));if(a&&"jr-msg"===a.name)a.value.split(";").forEach((function(e,t){r[t].msg=e}));if(a&&"jr-area"===a.name)a.value.split(";").forEach((function(e,t){r[t].area=e}))}r.forEach((function(r){t.watch(e,r.event,r.msg,r.area)}))},t.prototype.getCurrentElement=function(e){var t=e.outerHTML.match("<.+?>");return t&&t[0]||""},t.prototype.listener=function(e,t){if(t instanceof MouseEvent)this.provider.track({msg:t.target instanceof HTMLElement?this.getCurrentElement(t.target):"",ms:"action",ml:"info",at:t.type,el:t.target instanceof HTMLElement?this.getCurrentElement(t.target):void 0,x:t.x,y:t.y});else if(t instanceof DragEvent)this.provider.track({msg:t.target instanceof HTMLElement?this.getCurrentElement(t.target):"",ms:"action",ml:"info",at:t.type,el:t.target instanceof HTMLElement?this.getCurrentElement(t.target):void 0,x:t.x,y:t.y});else if(t instanceof TouchEvent)for(var r=t.changedTouches.length,n=0;n<r;++n)this.provider.track({msg:""+t.type,ms:"action",ml:"info",at:t.type,el:t.target instanceof HTMLElement?this.getCurrentElement(t.target):void 0,x:t.changedTouches[n].clientX,y:t.changedTouches[n].clientY,c:r>1?n:void 0});else t instanceof FocusEvent?this.provider.track({msg:t.target instanceof HTMLElement?this.getCurrentElement(t.target):"",ms:"action",ml:"info",at:t.type,el:t.target instanceof HTMLElement?this.getCurrentElement(t.target):void 0}):t instanceof KeyboardEvent?this.provider.track({msg:t.type+" "+t.key,ms:"action",ml:"info",at:t.type,key:t.key}):t instanceof InputEvent?this.provider.track({msg:t.inputType+" "+t.data,ms:"action",ml:"info",at:t.type}):this.provider.track({msg:""+t,ms:"action",ml:"info",at:t.type})},t.prototype.watch=function(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];if(!e||!t)throw new Error("[ActionHook.watch] arguments with somethine error, start watch failed");var o=new NodeEventHandlerMap;o.node=e,o.event=t,o.handler=this.listener.bind(this,r),this.handlerMap.push(o),e&&e.addEventListener(t,o.handler)},t.prototype.unwatch=function(e,t){for(var r=this.handlerMap.length-1;r>=0;r--)this.handlerMap[r].node==e&&this.handlerMap[r].event==t&&(e&&e.removeEventListener(t,this.handlerMap[r].handler),this.handlerMap.splice(r,1))},t}(AbstractHook),UncaughtHook=function(e){function t(t){var r=e.call(this,t)||this;return r.handler=r.listener.bind(r),r}return __extends(t,e),t.prototype.listener=function(e){e.stopPropagation(),e.preventDefault(),this.provider.track({msg:e.reason,ms:"uncaught",ml:"error"})},t.prototype.watch=function(){on("unhandledrejection",this.handler)},t.prototype.unwatch=function(){off("unhandledrejection",this.handler)},t}(AbstractHook),SPARouterHook=function(e){function t(t){var r=e.call(this,t)||this;return r.hashchangeHandler=r.handleHashchange.bind(r),r.historystatechangedHandler=r.handleHistorystatechange.bind(r),r}return __extends(t,e),t.prototype.hackState=function(e){replace(history,e,(function(t,r,n){replace(window,"onpopstate",(function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return window._replace_center_.onpopstate.apply(this,t)}));var o=location.href,i=window._replace_center_[e].apply(history,[t,r,n]);if(!n||n===o)return i;try{var a=o.split("#"),s=n.split("#"),c=parseUrl(a[0]),u=parseUrl(s[0]),l=a[1]&&a[1].replace(/^\/?(.*)/,"$1"),f=s[1]&&s[1].replace(/^\/?(.*)/,"$1");c!==u?dispatchCustomEvent("historystatechanged",u):l!==f&&dispatchCustomEvent("historystatechanged",f)}catch(e){}return i}))},t.prototype.dehackState=function(e){reduction(history,e),reduction(window,"onpopstate")},t.prototype.handleHashchange=function(e){var t=parseHash(location.hash.toLowerCase());pv(this.provider,t)},t.prototype.handleHistorystatechange=function(e){var t=parseHash(e.detail.toLowerCase());pv(this.provider,t)},t.prototype.watch=function(){this.hackState("pushState"),this.hackState("replaceState"),on("hashchange",this.hashchangeHandler),on("historystatechanged",this.historystatechangedHandler)},t.prototype.unwatch=function(){this.dehackState("pushState"),this.dehackState("replaceState"),off("hashchange",this.hashchangeHandler),off("historystatechanged",this.historystatechangedHandler)},t}(AbstractHook),PerformanceHook=function(e){function t(t){var r=e.call(this,t)||this;return r.handler=r.listener.bind(r),r}return __extends(t,e),t.prototype.listener=function(e){var t=this;setTimeout((function(){t.provider.track(__assign(__assign({},perforPage()),{msg:"",ms:"performance",ml:"info"}))}),20)},t.prototype.watch=function(){on("load",this.handler)},t.prototype.unwatch=function(){off("load",this.handler)},t}(AbstractHook),HooksFactory=function(){function e(e){this.hooks=new Map,this.provider=e}return e.prototype.reigster=function(e,t){for(var r,n=this.hooks.keys();!(r=n.next()).done;)if(r.value===e)throw TypeError('the hook type "'+e+'" already exists！');return this.hooks.set(e,new t(this.provider)),this},e.prototype.watch=function(e){for(var t,r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];if(!this.hooks.has(e))throw TypeError('hook type "'+e+'" does not exist, please register first！');return null===(t=this.hooks.get(e))||void 0===t||t.watch.apply(t,__spread(r)),this},e.prototype.unwatch=function(e){for(var t,r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];if(!this.hooks.has(e))throw TypeError('hook type "'+e+'" does not exist, please register first！');return null===(t=this.hooks.get(e))||void 0===t||t.unwatch.apply(t,__spread(r)),this},e.prototype.initlize=function(){return this.reigster("error",ErrorHook),this.reigster("uncaught",UncaughtHook),this.reigster("action",ActionHook),this.reigster("spa",SPARouterHook),this.reigster("performance",PerformanceHook),this},e}(),MonitorCenter=function(){function e(e){this.consumers=[],this.store=new Store(e),this.provider=new MonitorProvider(this.store),this.hooks=new HooksFactory(this.provider).initlize(),pv(this.provider)}return e.prototype.start=function(e,t){var r=this;void 0===e&&(e=15e3),this.timer&&clearInterval(this.timer),this.timer=window.setInterval((function(){return __awaiter(r,void 0,void 0,(function(){var e;return __generator(this,(function(r){switch(r.label){case 0:return[4,this.store.shiftMore(t)];case 1:return(e=r.sent())&&this.consumers.forEach((function(t){t.consume(e)})),[2]}}))}))}),e)},e.prototype.stop=function(){clearInterval(this.timer),this.timer=void 0},e.prototype.subscribe=function(e,t,r,n){return this.consumers.push(new MonitorConsumer(e,t,r,n)),this.consumers[this.consumers.length-1]},e.prototype.getStore=function(){return this.store},e.prototype.getProvider=function(){return this.provider},e}();exports.AbstractHook=AbstractHook,exports.CircuitBreaker=CircuitBreaker,exports.MonitorCenter=MonitorCenter,exports.lifeCycle=lifeCycle;
